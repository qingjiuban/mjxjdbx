<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>点单系统</title>
<style>
body {
  font-family: "微软雅黑", sans-serif;
  background:#f5f5f5;
  margin:0;
  padding:10px;
}

.container {
  max-width:500px;
  margin:auto;
  background:#fff;
  padding:10px;
  min-height:100vh;
}

/* ===== 订单显示 ===== */
.order {
  display:flex;
  align-items:center;
  background:#fafafa;
  border-radius:6px;
  padding:6px 8px;
  margin-bottom:4px;
}

.num {
  width:26px;
  text-align:right;
  margin-right:6px;
  color:#666;
}

.type {
  width:28px;
  height:28px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  margin-right:8px;
  font-weight:bold;
  color:#fff;
}

.type.外 { background:#f44336; }
.type.打 { background:#FFEB3B; color:#000; }
.type.堂 { background:#4CAF50; }

.noodle {
  flex:1;
  letter-spacing:4px;
  font-size:16px;
}

.del {
  border:none;
  background:none;
  color:#f44336;
  font-size:18px;
  cursor:pointer;
}

/* ===== 控制区 ===== */
.controls {
  border-top:1px solid #eee;
  padding-top:10px;
  margin-top:10px;
}

.type-btn {
  width:60px;
  height:60px;
  border-radius:50%;
  font-size:22px;
  margin-right:8px;
  color:#fff;
  border:none;
}

.type-btn.外 { background:#f44336; }
.type-btn.打 { background:#FFEB3B; color:#000; }
.type-btn.堂 { background:#4CAF50; }

.noodle-btn {
  padding:8px 16px;
  border:1px solid #333;
  margin:5px;
  font-size:16px;
}
</style>
</head>

<body>
<div class="container">

<!-- 订单列表 -->
<div id="orderList"></div>

<!-- 控制区 -->
<div class="controls">
  <div class="type-btns">
    <!-- 按钮顺序：堂 ｜ 外 ｜ 打 -->
    <button class="type-btn 堂" onclick="setType('堂')">堂</button>
    <button class="type-btn 外" onclick="setType('外')">外</button>
    <button class="type-btn 打" onclick="setType('打')">打</button>
  </div>

  <div>
    <button class="noodle-btn" onclick="addNoodle('宽')">宽</button>
    <button class="noodle-btn" onclick="addNoodle('细')">细</button>
  </div>
</div>

</div>

<script>
/* ===== Supabase 配置 ===== */
const SUPABASE_URL = 'https://jfaxvecohlmgbscebujq.supabase.co';
const SUPABASE_KEY =
'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpmYXh2ZWNvaGxtZ2JzY2VidWpxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU5ODA0NDAsImV4cCI6MjA4MTU1NjQ0MH0.jW0SSkeiNqoDN8ywe45lnaDEnw6X3BUjcjfhxsnxy04';

/* ===== 前端状态 ===== */
let currentType = '';
let noodles = [];
let localOrders = [];

/* ===== 设置类型 ===== */
function setType(t) {
  currentType = t;
  trySubmit();
}

/* ===== 叠加面条 ===== */
function addNoodle(n) {
  noodles.push(n);
  trySubmit();
}

/* ===== 自动写入数据库 ===== */
function trySubmit() {
  if (!currentType || noodles.length === 0) return;

  fetch(SUPABASE_URL + '/rest/v1/orders', {
    method: 'POST',
    headers: {
      apikey: SUPABASE_KEY,
      Authorization: 'Bearer ' + SUPABASE_KEY,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify([{
      type: currentType,
      noodle: noodles.join('')
    }])
  }).then(loadOrders);

  noodles = [];
}

/* ===== 从数据库加载（只读） ===== */
function loadOrders() {
  fetch(SUPABASE_URL + '/rest/v1/orders?select=*&order=created_at.asc', {
    headers: {
      apikey: SUPABASE_KEY,
      Authorization: 'Bearer ' + SUPABASE_KEY
    }
  })
  .then(r => r.json())
  .then(data => {
    localOrders = data;
    renderOrders();
  });
}

/* ===== 渲染订单（兼容老数据） ===== */
function renderOrders() {
  const box = document.getElementById('orderList');
  box.innerHTML = '';

  localOrders.forEach((o, i) => {
    const type = o.type || o.eat_type || '？';
    const noodle = o.noodle || o.mian || '';

    box.innerHTML += `
      <div class="order">
        <div class="num">${i + 1}</div>
        <div class="type ${type}">${type}</div>
        <div class="noodle">${noodle}</div>
        <button class="del" onclick="removeLocal(${i})">✕</button>
      </div>
    `;
  });
}

/* ===== 删除：只删页面，不碰数据库 ===== */
function removeLocal(index) {
  localOrders.splice(index, 1);
  renderOrders();
}

/* 初始化 */
loadOrders();
</script>

</body>
</html>